{
  "Actions": [
    {
      "Id": 1,
      "Name": "Remove Prefix of Fact (f) and Dim (d)",
      "Enabled": "true",
      "Execute": "// Define prefixes to remove (case-insensitive)\nvar prefixesToRemove = new[] { \"Factview\", \"Dimview\", \"Fact\", \"Dim\", \"F_\", \"D_\" };\n\nforeach (var table in Model.Tables.ToList())\n{\n    string originalName = table.Name;\n    string newName = originalName;\n\n    foreach (var prefix in prefixesToRemove)\n    {\n        if (newName.StartsWith(prefix, StringComparison.OrdinalIgnoreCase))\n        {\n            // Remove the prefix\n            newName = newName.Substring(prefix.Length);\n\n            // Trim underscores, spaces, or hyphens that might follow\n            newName = newName.TrimStart('_', ' ', '-');\n\n            break; // Stop after first matching prefix\n        }\n    }\n\n    // Rename the table if needed\n    if (newName != originalName)\n    {\n        table.Name = newName;\n    }\n}\n",
      "Tooltip": "",
      "ValidContexts": "Model, Table"
    },
    {
      "Id": 2,
      "Name": "snake_case, camelCase, PascalCase to Proper Case",
      "Enabled": "true",
      "Execute": "/*\n * Title: Databricks Semantic Model Set-Up\n * Author: Johnny Winter, greyskullanalytics.com\n *\n *  This script, when executed, will loop through all tables and columns in the model and rename with friendly names. \n *  Names in snake_case, camelCase or PascalCase will all be converted to Proper Case.\n *  No table selections are required as all tables in the model will be processed, simply run the script.\n *  Whilst looping though columns it also sets default summarization to none and sets a format string for all DateTime type fields \n *  (currently it sets format 'yyyy-mm-dd' but you can change this on line 61 if you wish).\n *\n */\nusing System;\nusing System.Globalization;\n\n//create script as class so it can be reused \nclass p {\n\n    public static void ConvertCase(dynamic obj)\n    {\n        TextInfo textInfo = CultureInfo.CurrentCulture.TextInfo;\n        //replace underscores with a space\n        var oldName = obj.Name.Replace(\"_\", \" \");\n        var newName = new System.Text.StringBuilder();\n        for(int i = 0; i < oldName.Length; i++) {\n            // First letter should always be capitalized:\n            if(i == 0) newName.Append(Char.ToUpper(oldName[i]));\n\n            // A sequence of two uppercase letters followed by a lowercase letter should have a space inserted\n            // after the first letter:\n            else if(i + 2 < oldName.Length && char.IsLower(oldName[i + 2]) && char.IsUpper(oldName[i + 1]) && char.IsUpper(oldName[i]))\n            {\n                newName.Append(oldName[i]);\n                newName.Append(\" \");\n            }\n\n            // All other sequences of a lowercase letter followed by an uppercase letter, should have a space\n            // inserted after the first letter:\n            else if(i + 1 < oldName.Length && char.IsLower(oldName[i]) && char.IsUpper(oldName[i+1]))\n            {\n                newName.Append(oldName[i]);\n                newName.Append(\" \");\n            }\n            else\n            {\n                newName.Append(oldName[i]);\n            }\n        }\n        //apply Proper Case where this has not already been taken care of above\n        obj.Name = textInfo.ToTitleCase(newName.ToString());\n    }\n}\n\nforeach(var t in Model.Tables) {\n//convert table names\n    p.ConvertCase(t);\n//convert column names\n    foreach(var c in t.Columns) {\n        p.ConvertCase(c);\n        c.SummarizeBy = AggregateFunction.None;\n        if (c.DataType == DataType.DateTime)\n        {c.FormatString = \"yyyy-mm-dd\";}\n    }\n}\n",
      "Tooltip": "Johnny Winter Databricks Model Set-up",
      "ValidContexts": "Model"
    },
    {
      "Id": 3,
      "Name": "Display folders for columns [Documentation]",
      "Enabled": "true",
      "Execute": "//Go through each table in the model\nforeach(var table in Model.Tables) \n{\n   if(table.Name != \"Date\"){\n    //First look at columns\n     foreach( var column in table.Columns)\n        {\n        var keySuffix = \"Key\";\n        var columnDateType = column.DataType.ToString();\n            //DWCreatedDate column should be hidden in a sepearte folder\n            if( column.Name == \"DWCreatedDate\")\n            {\n                column.DisplayFolder = \"Attributes\\\\Metadata\";   \n                column.IsHidden = true;   \n            }\n            //Numeric columns should not be aggregated and float (double) data type should not be used\n            if(column.DataType == DataType.Double || column.DataType == DataType.Decimal ||  column.DataType == DataType.Int64)\n            {\n                column.DisplayFolder = \"Numeric\";  \n                column.SummarizeBy = AggregateFunction.None;\n                if(column.DataType == DataType.Double)\n                {\n                    column.DataType = DataType.Decimal;\n                }\n            }\n            //Boolean data types into their own folder\n            if(column.DataType == DataType.Boolean)\n            {\n                column.DisplayFolder = \"Flags\";  \n            }\n            if(column.DataType == DataType.String)\n            {\n                column.DisplayFolder = \"Attributes\";  \n            }\n            //Keys go into their own display folder, should not be aggregrated and hidden. \n            if(column.UsedInRelationships.Any()) \n            {\n                column.DisplayFolder = \"Key\";\n                column.SummarizeBy = AggregateFunction.None;\n                column.IsHidden = true;\n            }\n            //Date keys get their own folder and other dates go in attributes\n           if( columnDateType == \"DateTime\" && column.Name != \"DWCreatedDate\")\n            {\n                if(column.UsedInRelationships.Any()) \n                {\n                    column.DisplayFolder = \"Key\";\n                    column.IsHidden = true;\n                }\n                else{\n                    column.DisplayFolder = \"Dates\";\n                    \n                }\n            }}}}",
      "Tooltip": "",
      "ValidContexts": "Model"
    },
    {
      "Id": 4,
      "Name": "Create Global & Local Measure Group [Documentation]",
      "Enabled": "true",
      "Execute": "// ************CREATE GLOBAL MEASURE TABLE**************\n// Create a calculated table with a single hidden column:\nvar measuretable = Model.AddCalculatedTable(\"Global Measures\", \"{0}\");\nmeasuretable.Columns[0].IsHidden = true;\nmeasuretable.Description = \"Locate global semantic model measures here\";\n\n// Add a placeholder measure to the Global Measures table\nvar newMeasure = measuretable.AddMeasure(\n    \"Placeholder\",          // Name\n    \" \",                    // DAX expression (blank placeholder)\n    \"Global Measures\"       // Display Folder\n);\n\n\n// ************CREATE LOCAL MEASURE TABLE**************\n// Create another calculated table for local measures\nvar localMeasureTable = Model.AddCalculatedTable(\"Local Measures\", \"{0}\");\nlocalMeasureTable.Columns[0].IsHidden = true;\nlocalMeasureTable.Description = \"Locate report level measures here\";\n\n// Add a dummy measure to the Local Measures table\nvar localMeasure = localMeasureTable.AddMeasure(\n    \"Local Measure\",                // Name\n    \" \",                            // DAX expression (blank placeholder)\n    \"Local Measures\"                // Display Folder\n);\nlocalMeasure.Description = \"For Report Level Measures\";\n",
      "Tooltip": "",
      "ValidContexts": "Model"
    },
    {
      "Id": 5,
      "Name": "Create Last Refresh [Documentation]",
      "Enabled": "true",
      "Execute": "// ************ CREATE A LAST REFRESH TABLE ************\nvar lastrefreshtable = Model.AddTable(\"Last Refresh\");\n\n// Define M expression for the table\nModel.Tables[\"Last Refresh\"].Partitions[\"Last Refresh\"].Expression = @\"\nlet\n    Source = DateTimeZone.FixedLocalNow()\nin\n    Source\n\";\n\n// Add hidden column for last refresh datetime\nvar dataColumn = lastrefreshtable.AddDataColumn(\"Last Refresh\");\ndataColumn.IsHidden = true;\ndataColumn.DisplayFolder = \"Columns\";\ndataColumn.DataType = DataType.DateTime;\ndataColumn.SourceColumn = \"Last Refresh\";\n\n// Add measure to display the last refresh time\nvar measure = lastrefreshtable.AddMeasure(\"Last Refreshed\");\nmeasure.FormatString = \"MMM DD hh:mm\";\nmeasure.Expression = \"FORMAT(MAX('Last Refresh'[Last Refresh]), \\\"MMM DD, HH:mm\\\")\";\n",
      "Tooltip": "",
      "ValidContexts": "Model"
    },
    {
      "Id": 6,
      "Name": "Move measures from fact to Global Measures",
      "Enabled": "true",
      "Execute": "// Ensure Global Measures table exists\nTable globalTable;\nif (!Model.Tables.Any(t => t.Name == \"Global Measures\"))\n{\n    globalTable = Model.AddTable(\"Global Measures\");\n    globalTable.IsHidden = true;\n}\nelse\n{\n    globalTable = Model.Tables[\"Global Measures\"];\n}\n\n// Tables to exclude\nvar excludedTables = new[] { \"Global Measures\", \"Local Measures\" };\n\n// Store original measures to delete later\nvar measuresToDelete = new List<Measure>();\n\n// FIRST PASS: create all measures\nforeach (var table in Model.Tables.Where(t => !excludedTables.Contains(t.Name)))\n{\n    foreach (var measure in table.Measures)\n    {\n        // Clean measure name (remove trailing \" 1\")\n        var cleanName = measure.Name.EndsWith(\" 1\")\n            ? measure.Name.Substring(0, measure.Name.Length - 2)\n            : measure.Name;\n\n        // Skip if measure already exists in Global Measures\n        if (globalTable.Measures.Any(m => m.Name == cleanName))\n            continue;\n\n        var newMeasure = globalTable.AddMeasure(\n            cleanName,\n            measure.Expression\n        );\n\n        // Display folder: TableName\\OriginalFolder\n        newMeasure.DisplayFolder =\n            string.IsNullOrEmpty(measure.DisplayFolder)\n                ? table.Name\n                : table.Name + \"\\\\\" + measure.DisplayFolder;\n\n        // Copy metadata\n        newMeasure.FormatString = measure.FormatString;\n        newMeasure.Description = measure.Description;\n        newMeasure.IsHidden = measure.IsHidden;\n\n        measuresToDelete.Add(measure);\n    }\n}\n\n// SECOND PASS: delete originals\nforeach (var measure in measuresToDelete)\n{\n    measure.Delete();\n}\n\n\n// Copy list to avoid collection modification issues\nvar measures = globalTable.Measures.ToList();\n\nforeach (var measure in measures)\n{\n    if (!measure.Name.EndsWith(\" 1\"))\n        continue;\n\n    var baseName = measure.Name.Substring(0, measure.Name.Length - 2);\n\n    // Only rename if base name doesn't already exist\n    if (globalTable.Measures.Any(m => m.Name == baseName))\n        continue;\n\n    measure.Name = baseName;\n}\n\nModel.Tables[\"Global Measures\"].Measures[\"Placeholder\"].Delete();\r\n",
      "Tooltip": "",
      "ValidContexts": "Model"
    },
    {
      "Id": 7,
      "Name": "All Time Intelligence for selected measures [Measure]",
      "Enabled": "true",
      "Execute": "var dateColumn = \"'Date'[Date]\";\n\n// Creates time intelligence measures for every selected measure:\nforeach(var m in Selected.Measures) {\n    // Year-to-date:\n    m.Table.AddMeasure(\n        m.Name + \" YTD\",                                       // Name\n        \"TOTALYTD(\" + m.DaxObjectName + \", \" + dateColumn + \")\",     // DAX expression\n        m.DisplayFolder                                        // Display Folder\n    );\n    \n    // Previous year:\n    m.Table.AddMeasure(\n        m.Name + \" PY\",                                       // Name\n        \"CALCULATE(\" + m.DaxObjectName + \", SAMEPERIODLASTYEAR(\" + dateColumn + \"))\",     // DAX expression\n        m.DisplayFolder                                        // Display Folder\n    );    \n    \n    // Year-over-year\n    m.Table.AddMeasure(\n        m.Name + \" YoY\",                                       // Name\n        m.DaxObjectName + \" - [\" + m.Name + \" PY]\",            // DAX expression\n        m.DisplayFolder                                        // Display Folder\n    );\n    \n    // Year-over-year %:\n    m.Table.AddMeasure(\n        m.Name + \" YoY%\",                                       // Name\n        \"DIVIDE([\" + m.Name + \" YoY], [\" + m.Name + \" PY])\",    // DAX expression\n        m.DisplayFolder                                         // Display Folder\n    ).FormatString = \"0.0 %\";                                   // Set format string as percentage\n    \n    // Quarter-to-date:\n    m.Table.AddMeasure(\n        m.Name + \" QTD\",                                            // Name\n        \"TOTALQTD(\" + m.DaxObjectName + \", \" + dateColumn + \")\",    // DAX expression\n        m.DisplayFolder                                             // Display Folder\n    );\n    \n    // Month-to-date:\n    m.Table.AddMeasure(\n        m.Name + \" MTD\",                                       // Name\n        \"TOTALMTD(\" + m.DaxObjectName + \", \" + dateColumn + \")\",     // DAX expression\n        m.DisplayFolder                                        // Display Folder\n    );\n}\n",
      "Tooltip": "",
      "ValidContexts": "Measure"
    },
    {
      "Id": 8,
      "Name": "Create Table Groups [Documentation]",
      "Enabled": "true",
      "Execute": "// ************ CREATE TABLE GROUPS **************\n\n// Loop through all tables in the model:\nforeach (var table in Model.Tables)\n{\n    if (table is CalculationGroupTable)\n    {\n        // Assign table group for calculation groups:\n        table.TableGroup = \"Calculation Groups\";\n    }\n    else if (!table.UsedInRelationships.Any() && table.Measures.Any(m => m.IsVisible))\n    {\n        // Tables containing visible measures, but no relationships to other tables:\n        table.TableGroup = \"Measure Groups\";\n    }\n    else if (table.UsedInRelationships.All(r => r.FromTable == table) && table.UsedInRelationships.Any())\n    {\n        // Tables exclusively on the \"many\" side of relationships:\n        table.TableGroup = \"Facts\";\n    }\n    else if (!table.UsedInRelationships.Any() && table is CalculatedTable && !table.Measures.Any())\n    {\n        // Tables without any relationships that are calculated tables \n        // and do not have measures:\n        table.TableGroup = \"Parameter Tables\";\n    }\n    else if (table.UsedInRelationships.Any(r => r.ToTable == table))\n    {\n        // Tables on the \"one\" side of relationships:\n        table.TableGroup = \"Dimensions\";\n    }\n    else\n    {\n        // All other tables:\n        table.TableGroup = \"Misc\";\n    }\n}\n",
      "Tooltip": "",
      "ValidContexts": "Model, TableOrCG"
    }
  ]
}